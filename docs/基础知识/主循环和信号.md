# 主循环和信号

1. 与大多是GUI开发套件一样，GTK+ 同样使用了事件驱动模型
2. 当用户没有任何操作的时候，GTK+ 应用就会运行在主循环，等待用户输入。如果用户采取了行动，诸如鼠标点击，那么主循环就会唤醒对应的时间处理。
3. 通常组件接收到一个事件，他们会发出一个或多个信号。信号通知程序调用对应的处理函数来处理相应的信号，就好比中断信号一样，调用对应的中断处理函数。这些函数就是熟知的回调函数。相应的回调函数的处理必须得当，诸如一个按钮点击后触发点击事件，发送点击信号，回调函数处理，弹出对话框选取文件，选取完毕后应该能够回退到主循环中，继续处理后序用户操作。

```
handler_id = widget.connect("event", callback, data)
```

1. widget 必须在先前实例化
2. event 必须是定义范围内，每个widget都有一些特有的事件，event应该选取有必要做出相应处理的有意义的事件
3. callback 是回调函数，当具体事件触发会调用该函数进行处理
4. data 可选参数，当事件发生的时候作为参数传递给回调函数，相当于回调函数的参数
5. handler_id 返回值是一个表示 **信号-回调函数** 唯一配对的标识符，如果后序要更新这种调用关系就要用到这个作为参数。就好比结婚证绑定了男方女方，离婚的时候也要这个结婚证。有了结婚证你就能找到男方女方这一唯一配对的对应关系。

```
widget.disconnect(handler_id)
```

6. 如果你丢掉了结婚证，也就是说忘记了 handler_id 怎么办？还提供了通过回调函数来断开这种关系的方法

```
widget.disconnect_by_func(callback)
```

7. 应用至少应该连接顶层窗口的“destroy”信号，例如，一个关闭确认的按钮，作为顶层窗口（还有主体程序），那么当顶层窗口确认关闭的时候，主体程序并没有关闭，这是应为“destroy”信号默认只会关闭自身窗口，因此需要连接“destroy”到主体程序，主循环Gtk.main中的退出操作Gtk。main_quit() 函数

```
window.connect("destroy", Gtk.main_quit)
```

调用 Gtk.main_quit 会使得 Gtk.main() 结束并return。退出GUI应用。
